
may1_23

rev.04

Steady 5vDC output

9-50vDC input (no load)

8-46vDC input (drawing 0.5 - 1.4 Watt load)



***
11/10/25

	test most current board, with a rpi load
	look at new topologies
	reorganize git	
		5116_05 > bury in new folder
		git folder is rpi_hat
		new folder: 5013-5v
		


new topology: LM5013 - 6-100vin (48v nominal) 3.5A out
	schematic captured, assigning footprints

	called out schottkey diode not available
		new selection: V20PW22HM3_A/I
		added to webench design, and it broke.


***
testing powerhat_rev4.0

test case:
	riden power supply, sweeping DCv, Iout=300mA
	waveforms scope1+ to hat_TP_5v
	observing using waveforms voltmeter
	all equipment gnds connected
	
	Load: 1 small LED + 1kohm R series, tp_5v>gnd

<DC8v: voltage drops to ~1.4v
>DC8.1v: 5.07v, 50mA

sweeping V, in 1v steps:
	as Vin increases, I decreases (expected)
stability drops off at DC46V = 5.06V 32mA

Vout off, adjusted to 50v, vout on
	stable for a few seconds, then drops off
	~1.4V output
tried the same at 48V 52V and 54V
	same result, tho the lower the V the longer it takes to fall apart
	
	
Conclusion: (not quite true)
Rev4 operable with small (<50mA) load
	DC8.1V to 46V 

further testing:
	only sat at each voltage for a few seconds; 
	stress testing at 46V
		by 7minutes, Vout dropped to 3v

	testing again with observation:
		46V held 30mA load @ 5V for 5 minutes
	
	testing at
		24V held 42mA @ 5V at least 12 minutes
			(expecting at least twice as much time)

switching voltmeter to scope 1

ripple present:

8.1v	100mV	>1MHz
9v	139mV	>500kHz
12v	123mV	>500kHz
24v	115mV	200kHz
46v	165mV	150kHz
	 
50v	44mV	600kHz	Vout drops to 1.4V
	fairly abrupt drop, swinging oscillations observed briefly
		then stable
55V	vout drops to 1V

____
pulling LED, adding rpi3 load
		no peripherials

setting riden supply direct to rpi gpio power
	5V 1A
	rpi load spikes to 550mA

attaching powerhat
	
12vin
	vout falls to 3.5v
24vin
	vout falls to 4.8v
36vin
	vout falls to 4v
46vin
	vout falls to 2.7v

scope
24vin 1A	sawtooth wave, 1v peak2peak
		avg 3.5v	
24vin 2A	square with sawtooth lows
		2.5v p2p
		avg 4.2v
		
24vin 3A	avg 4.7v, max 5.2v
		2v p2p
		providing more current gets us closer
			tho riden displays 50mA

	****		
	signal not clean enough to truely power rpi
	*****









****
5013 datasheet layout guidelines:

To help eliminate these problems, bypass the VIN pin to GND with a low-ESR ceramic bypass capacitor with
a high-quality dielectric. Place CIN as close as possible to the VIN and GND pins. Grounding for both the
input and output capacitors must consist of localized top-side planes that connect to the GND pin and GND
PAD.
• Minimize the loop area formed by the input capacitor connections to the VIN and GND pins.
• Place the inductor and Schottky diode close to the SW pin. Minimize the area of the SW trace or plane to
prevent excessive capacitive coupling.
• Place the Schottky diode anode pin in close proximity to input capacitor ground or return.
• Tie the GND pin directly to the power pad under the device and to a heat-sinking PCB ground plane.
• Use a ground plane in one of the middle layers as a noise shielding and heat dissipation path.
• Have a single-point ground connection to the plane. Route the ground connections for the feedback, soft
start, and enable components to the ground plane, which prevents any switched or load currents from flowing
in analog ground traces. If not properly handled, poor grounding results in degraded load regulation or erratic
output voltage ripple behavior.
• Make VIN, VOUT, and ground bus connections as wide as possible, which reduces any voltage drops on the
input or output paths of the converter and maximizes efficiency.
Minimize trace length to the FB pin. Place both feedback resistors, RFB1 and RFB2, close to the FB pin. Place
CFF (if needed) directly in parallel with RFB1. If output setpoint accuracy at the load is important, connect the
VOUT sense at the load. Route the VOUT sense path away from noisy nodes and preferably through a layer on
the other side of a grounded shielding layer.
• The RON pin is sensitive to noise. Thus, locate the RRON resistor as close as possible to the device and route
with minimal lengths of trace. The parasitic capacitance from RON to GND must not exceed 20 pF.
• Provide adequate heat sinking for the LM5013 to keep the junction temperature below 150°C. For operation
at full rated load, the top-side ground plane is an important heat-dissipating area. Use an array of heatsinking vias to connect the exposed pad to the PCB ground plane. If the PCB has multiple copper layers,
these thermal vias must also be connected to inner layer heat-spreading ground planes.





****
11/18/25

check bananajack module pcb carrier
	fit prototype into carrier if possible		#looks good

:40x72mm with 2mm safezone offset


*****
'Selecting an Ideal Ripple Generation Network for Constant-On-Time Buck Converter'
https://www.ti.com/lit/an/snva776a/snva776a.pdf?ts=1762791140202&ref_url=https%253A%252F%252Fwww.ti.com%252Flit%252Fds%252Fsymlink%252Flm5013.pdf%253Fts%253D1762789135733

from:
Type 3 Ripple Network:
	
	--feedback resistors create a divider that adjusts the output voltage--

added rev1 BOMs
	-kicad: 	kicad generated
	-part#.numbers	mac numbers worksheet
	-part#.csv	mouser upload format

rev1 BOM cost-mouser: 16.13 + 2.71 tariff


11/24/25
ordered multiple passive
	3 items each -d1, ic1, l1
ordered pcbs
fedex



****
12/02/25
parts arrived, pcb's arrived

populated pcb
dnp: cin2, cout2, c8,c9, r5, pgoodLED

waveforms test
riden 	psu + to Vin+
	psu - to Vin-
AD2 - 	scope1+ to Vout+
	scope1- to AD2gnd, Vout-

Voltmeter
no load besides AD2
riden set to 3Aout
	PSU DC	Vout	AC RMS (assume ripple)
	12	5.019	19mV
	7v	5.032	20mV
	6v	collapse
	24v	5.036	26mV
	36v	5.041	28mV
	48v	5.046	30mV
	56v	5.048	32mV
	59v	5.048	33mV	(maxxed out riden)

Scope
ripple frequency decreases as Vin increases


adding in breadboard
	powerhat to rails, scope on rails
	led+1kR, DHT22 load
patching rpi3, 5v gnd headers to rails
	voltmeter stabilized at ~4vDC
	initially encountered an undervoltage error
	reset power to reboot, succesfully booted raspian
	rolled through riden vout:
	48v, 32v, 28v, 20v, 12v, 7vdc
		rpi stayed booted no issues
	ripple/noise decreased as Vin decreased
	
tested a drop from 48v to 7v and rpi crashed & rebooted
	tested 48v to 12vdc, no problem
*try the same test with all the capacitors*


back to build
	led-	0603 footprint, 0805 package 5 onhand from 36628532 (mfg#APT2012LZGCK)
	r5- 	2.2k
added cin2, cout2, headers for vin vout

THTelectrocaps on hand were only rated for 50vDC, so ommitted

powering on, basic LED load
	pgood led is not lit
	pgood net at IC is 2mV
		was sort of unsure about this implementation anyway

switching to rpi load
	12vdc in	drawing 90-160mA, but not stable for pi
		keeps rebooting
	switching to 24vin, 48v, no change, not stable
removing rpi load
	stable 5vout, 7vin, 48vin
pulled r5 (led resistor), testing again


powering pi direct from riden, 5vout
	pi draws ~500mA
back to powerhat, took a while but booted at 18vDC in
drawing 125mA
scope is stable at 4.25vDC, powerhat is audibly noisy


attempted 48vin to 7vin, crashed the pi again
	pi did reboot at 7vin
pgood cicuit may have destablized the powerhat, also shutdown pi with software
	(while powered by the riden)
	which may have been the culprit
powerhat can jump from 7vin to 48vin while providing stable 5vout powering a pi
	thats cool.
	riden is supplying 40mA while powering pi
	[note the hdmi was backfeeding some power]

****
12/9/25

building out a 2nd board

pcb was designed 40x72mm 
pcb carriers on hand are 40x42mm (bananajack breakout)

***
ACS711
[NOTE: datasheet states <100v isolation applications]

current sense first tests:

riden psu to powerhat (24v)

vout+ to afe Ip/In to breadboard +
vout- 		to breadboard -
breadboard-	to afe earth & dgnd
		to ad2 gnd

breadboard has an LCD1602 & 1led installed

AD2 power supply 3.3v to AFE

AFE A2 to AD2 scope1+, 	A2 voltmeter: 1.66V

riden turned off	A2 voltmeter: 1.66v
	no change
	[3.3v /2 = 1.66v]		#read online that Vcc/2 is baseline, double check datasheet
	
[see diagram]
	*draw diagram

adding rPi to breadboard rails:
	(no hdmi out)

A2 voltmeter:	1.674-1.681v
(im not positive that the pi boots without the HDMI
	need to check with the TTL console cable)
riden is showing 44mA out

rpi does not appear to boot
	gets to a point then resets
	vout flucuates
added 22uf and 1uf electro caps to rails

okay
resetting riden to 5v and directly to breadboard rails
pi booted fine

AD2 reading 4.7V on positive rail
riden reading 500mA out

back to the powerhat, riden at 24v
pulled ACS711 out of the loop
will pi boot? 






unrelated - rightangle safety bananajacks can be had in semi-bulk from ebay
	for way less than mouser/individual
	knockoffs but says 1000v/24a

12/10/25
built 2nd pcb
	-DNP pgood1, r5, cout2, c8,c9

testing board2

noload
ridenVin	powerhatVout
	12	5.074
	24	5.087
	32	5.091
	48	5.096
	7	5.079
	6	null
	59	5.1

breadboard rails - LED + lCD1602
	similar results

adding pi load + hmdi
	riden pulling 95mA
	voltmeter on rails - 4.386
pi boots just fine
	note hdmi is backfeeding breadboard/pi
switching to powerhat1
	functional difference is Cout2 is populated
	pi boots just fine today
	weird
	rail is at 4.395, LCD flickers/dim
consider adding lm7805 regulator
	*7805 needs at least 7.3v input
	*doesnt fit the use case
	*could redesign powerhat to output 7.5v, to regulate to 5v
	*would only provides 1.5A output (7805 limitation)

the lcd + led on breadboard draw 14mA @ 5vin

cut down powerhat rev1 board 2 to fit into 40x42mm din rail carrier
	still works

****
12/15/25

installed puTTY on win10 q400a machine
connected usb-to-serial cable

powered pi via 2.4a microUSB cable
	confirmed serial connection

powered pi via powerhat
	was not able to boot/connect via serial

***
double checking lm5013 datasheet
	should be able to pull 3.5A max
seems like a current issue, when trying to boot, powerhat pulls up to 150mA from riden
with some regularity, drops to ~40mA, before rising back up
scope shows 5V DC with drops as low as 3.4V dc
coincides with current dropout


Pgood is open-drain output, Pull-up, needs connected to source V via 10k-100k R
	(i had it setup as a pulldown connected to GND)
	neither board has the pgood1 R or LED populated

going to try a 10k R from pgood to vout+ on board1
testing board 1 first (Same setup as earlier)

no change to rpi boot

added old pi-hat project, with the transistors and mosfets at 5v_Hat
no joy

back to riden direct, through the old pi-hat
pulling upwards of 700mA

using the riden/hat doesnt give a stable boot either (it was a trash hat anyway)
directly from the riden to pi doesnt give stable boot, suspect pi needs a true software reboot

reboot helped
was able to do a puTTY boot from riden

powerhat would not boot the rpi without an hdmi cable attached

suspect powerhat isnt providing enough current during startup
	& the stable 50mA backfed from the hdmi is enough to boot it

***
12/16/25

considered redesigning the 5013 to output 7.5v and using a 7805 for max 1.5A
	but realized just doing that wouldnt increase the current output of the 5013 as is

 


